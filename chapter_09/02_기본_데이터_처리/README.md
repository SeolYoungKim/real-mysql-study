# 기본 데이터 처리 
## 풀 테이블 스캔 & 풀 인덱스 스캔
### 풀 테이블 스캔 
- 인덱스를 사용하지 않고 테이블의 데이터를 처음부터 끝까지 읽어서 요청된 작업을 처리하는 것 
- 아래의 조건일 때 주로 풀 테이블 스캔 수행
  - 테이블 레코드 건수가 매우 작아, 인덱스를 통해 읽는 것 보다 풀 테이블 스캔을 하는 편이 더 빠른 경우(테이블이 페이지 1개로 구성된 경우)
  - where 절이나 on 절에 인덱스를 이용할 수 있는 적절한 조건이 없는 경우 
  - 인덱스 레인지 스캔을 사용할 수 있는 쿼리라고 하더라도, 옵티마이저가 판단한 조건 일치 레코드 건수가 너무 많은 경우(인덱스의 B-Tree를 샘플링해서 조사한 통계 정보 기준)
  - 보통 한꺼번에 여러 개의 블록이나 페이지를 읽어오는 기능이 내장돼 있음 

### InnoDB의 풀 테이블 스캔 
- 특정 테이블의 연속된 데이터 페이지가 읽히면, 백그라운드 스레드에 의해 리드 어헤드 작업이 자동으로 시작 됨
  - 리드 어헤드 : 어떤 영역의 데이터가 앞으로 필요해지리라는 것을 예측해서 요청이 오기 전에 미리 디스크에서 읽어 InnoDB 버퍼 풀에 가져다 두는 것 
- 풀 테이블 스캔 실행
  - 처음 몇 개의 데이터 페이지는 foreground 스레드(클라이언트 스레드)가 페이지 읽기 실행 
  - 특정 시점부터는 읽기 작업을 백그라운드 스레드로 위임
  - 백그라운드 스레드가 읽기를 넘겨받는 시점부터는 한번에 4개 or 8개씩의 페이지를 읽으면서 계속 그 수를 증가시킴
  - 이 때 한번에 최대 64개 데이터 페이지까지 읽어서 버퍼 풀에 저장함 
  - 포그라운드 스레드는 미리 버퍼 풀에 준비된 데이터를 가져다 사용 -> 쿼리 처리 속도 향상 


- 리드 어헤드는 풀 인덱스 스캔에서도 동일하게 사용된다.
```mysql
select count(*) from employees;  -- 풀 인덱스 스캔이 발생함 
select * from employees;  -- 풀 테이블 스캔이 발생함
```

<br/><br/>
## 병렬 처리 
하나의 쿼리를 여러 스레드가 작업을 나누어 동시에 처리하는 것을 의미 
- 여러 스레드가 동시에 각각의 쿼리를 처리하는 것은 MySQL이 처음 만들어 질 때부터 가능했으니 오해말자
- 아래와 같이 아무런 where 조건 없이 단순히 테이블의 전체 건수를 가져오는 쿼리만 병렬 처리 가능  

![img.png](img.png)
- 병렬 처리용 스레드 개수가 늘어날수록 쿼리 처리에 걸리는 시간이 줄어든다.
  - 하지만, 병렬 처리용 스레드 개수를 아무리 늘리더라도 서버에 장착된 CPU의 코어 개수를 넘어서는 경우는 오히려 성능이 떨어질 수 있으니 주의하자. 