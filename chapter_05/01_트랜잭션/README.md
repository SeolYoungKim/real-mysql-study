# 트랜잭션 
- 데이터의 정합성을 보장하기 위한 기능 (작업의 완전성 보장)
- 하나의 논리적인 작업 셋에 쿼리가 몇 개가 있든 관계 없이 논리적인 작업 셋 자체가 100% 적용되거나 아무것도 적용되지 않아야 함을 보장해주는 것 

## 트랜잭션 주의 사항
- 트랜잭션 범위는 최소화 하라(필요한 곳에만 적용할 것)

트랜잭션의 적용 예 
```text
1) 처리 시작
    -> 데이터베이스 커넥션 생성 
    -> 트랜잭션 시작
2) 사용자 로그인 여부 확인 
3) 사용자의 글쓰기 내용의 오류 여부 확인
4) 첨부로 업로드된 파일 확인 및 저장
5) 사용자의 입력 내용을 DBMS에 저장
6) 첨부 파일 정보를 DBMS에 저장
7) 저장된 내용 또는 기타 정보를 DBMS에서 조회
8) 게시물 등록에 대한 알림 메일 발송
9) 알림 메일 발송 이력을 DBMS에 저장
    <= 트랜잭션 종료(COMMIT)
    <= 데이터베이스 커넥션 반납
10) 처리 완료
```

### 트랜잭션 처리에 좋지 않은 영향을 미치는 부분 
- 보통 트랜잭션을 위와 같이 1번부터 적용함
  - 하지만 트랜잭션은 5번부터 적용됨 
  - 2, 3, 4번이 수행될 시간동안 쓸데없이 커넥션을 점유하게 됨 <br/><br/> 
- 8번 작업은 매우매우 위험하다
  - 메일 전송, FTP 파일 전송, 네트워크를 통한 원격 서버와의 통신과 같은 작업은 트랜잭션 내에서 제거해야 한다.
  - 외부와 통신할 수 없는 상황이 발생할 경우, 웹 서버 뿐 아니라 DBMS 서버까지 위험해짐 <br/><br/> 
- 절차에 DBMS의 작업이 크게 4개가 있음 
  - 사용자가 입력한 정보를 저장하는 5, 6번은 반드시 하나의 트랜잭션으로 묶어야 함 
  - 7번은 단순 조회 -> 트랜잭션에 포함할 필요 없음 
  - 9번은 성격이 다른 작업 -> 5&6 트랜잭션에 함께 묶지 않아도 됨(업무에 따라 다를 수 있음) -> 별도 트랜잭션으로 분리 


처리 절차 개선 
```text
1) 처리 시작
2) 사용자의 로그인 여부 확인
3) 사용자의 글쓰기 내용의 오류 발생 여부 확인
4) 첨부로 업로드된 파일 확인 및 저장
    => 데이터베이스 커넥션 생성(또는 커넥션 풀에서 가져오기)
    => 트랜잭션 시작
5) 사용자의 입력 내용을 DBMS에 저장
6) 첨부 파일 정보를 DBMS에 저장
    <= 트랜잭션 종료(COMMIT)
7) 저장된 내용 또는 기타 정보를 DBMS에서 조회
8) 게시물 등록에 대한 알림 메일 발송
    => 트랜잭션 시작
9) 알림 메일 발송 이력을 DBMS에 저장
    <= 트랜잭션 종료(COMMIT)
    <= 데이터베이스 커넥션 종료(또는 커넥션 풀에 반납)
10) 처리 완료
```
- 프로그램 코드가 커넥션을 가지고 있는 범위와, 활성화돼 있는 프로그램의 범위를 최소화 하자.
- 네트워크 작업이 있는 부분은 트랜잭션에서 배제하자.

